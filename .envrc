# Development environment configuration
# .envrc - direnv configuration for this project

# Load asdf versions from .tool-versions, but guard against missing plugin
if command -v asdf >/dev/null 2>&1; then
  if command -v direnv >/dev/null 2>&1; then
    # Prefer built-in direnv integration if available
    if typeset -f use_asdf >/dev/null 2>&1; then
      use asdf
    else
      # Fallback: ensure asdf shims on PATH
      export PATH="${ASDF_DATA_DIR:-$HOME/.asdf}/shims:${PATH}"
      export PATH="${ASDF_DIR:-$HOME/.asdf}/bin:${PATH}"
    fi
  else
    # No direnv functions, still add asdf to PATH
    export PATH="${ASDF_DATA_DIR:-$HOME/.asdf}/shims:${PATH}"
    export PATH="${ASDF_DIR:-$HOME/.asdf}/bin:${PATH}"
  fi
fi

# Environment variables
export NODE_ENV=development
export PYTHONDONTWRITEBYTECODE=1
export PYTHONUNBUFFERED=1

# Add local bin to PATH for npm/pip installed binaries
PATH_add ./node_modules/.bin
PATH_add ./.venv/bin

# Load secrets from .env if it exists
if [[ -f .env ]]; then
  dotenv .env
fi

# Optional: Add project-specific environment variables
# export API_HOST=localhost:3000
# export DB_URL=postgresql://localhost:5432/myproject

# Friendly message only when interactive
if [[ -t 1 ]]; then
  echo "âœ… Project environment loaded successfully"
fi

# AI providers (set in .env, not here)
# export OPENAI_API_KEY=sk-...
# export OPENAI_MODEL=gpt-4o-mini